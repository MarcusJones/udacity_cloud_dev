{
    "apiVersion": "extensions/v1beta1",
    "kind": "Deployment",
    "metadata": {
      "labels": {
        "service": "backend-feed"
      },
      "name": "backend-feed"
    },
    "spec": {
      "replicas": 3,
      "template": {
        "metadata": {
          "labels": {
            "service": "backend-feed"
          }
        },
        "spec": {
          "containers": [
            {
              "image": "plasmafrog/udacity-c3-feed-service",
              "name": "backend-feed",
              "imagePullPolicy": "Always",
              "resources": {
                "requests": {
                  "memory": "64Mi",
                  "cpu": "250m"
                },
                "limits": {
                  "memory": "1024Mi",
                  "cpu": "500m"
                }
              },
              "env": [
                { "name": "POSTGRES_USERNAME",          "valueFrom": { "secretKeyRef": { "name": "env-secret", "key": "POSTGRES_USERNAME" } } },
                { "name": "POSTGRES_PASSWORD",          "valueFrom": { "secretKeyRef": { "name": "env-secret", "key": "POSTGRES_PASSWORD" } } },
                { "name": "POSTGRES_DATABASE",          "valueFrom": { "secretKeyRef": { "name": "env-secret", "key": "POSTGRES_DATABASE" } } },
                { "name": "POSTGRES_HOST",              "valueFrom": { "secretKeyRef": { "name": "env-secret", "key": "POSTGRES_HOST" } } },
                { "name": "POSTGRES_AWS_REGION",        "valueFrom": { "secretKeyRef": { "name": "env-secret", "key": "POSTGRES_AWS_REGION" } } },
                { "name": "POSTGRES_AWS_PROFILE",       "valueFrom": { "secretKeyRef": { "name": "env-secret", "key": "POSTGRES_AWS_PROFILE" } } },
                { "name": "POSTGRES_AWS_MEDIA_BUCKET",  "valueFrom": { "secretKeyRef": { "name": "env-secret", "key": "POSTGRES_AWS_MEDIA_BUCKET" } } },
                { "name": "JWT_SECRET",                 "valueFrom": { "secretKeyRef": { "name": "env-secret", "key": "JWT_SECRET" } } }
              ],
              "volumeMounts": [
                {
                  "name": "aws-secret",
                  "mountPath": "/root/.aws/",
                  "readOnly": true
                }          
              ]
            }
          ],
          "restartPolicy": "Always",
          "volumes": [
            {
              "name": "aws-secret",
              "secret": {
                "secretName": "aws-secret"
              }
            }
          ]
        }
      }
    }
  }